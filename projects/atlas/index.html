<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>A new brain atlas | Frederik Hartmann</title> <meta name="author" content="Frederik Hartmann"> <meta name="description" content="A brain atlas from scratch"> <meta name="keywords" content="Frederik, Hartmann"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://frederik-hartmann.github.io/projects/atlas/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Frederik </span>Hartmann</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">A new brain atlas</h1> <p class="post-description">A brain atlas from scratch</p> </header> <article> <hr> <p>Authors: <a href="https://github.com/Frederik-Hartmann" rel="external nofollow noopener" target="_blank">Frederik Hartmann</a>, <a href="https://xavibeltranurbano.github.io/" rel="external nofollow noopener" target="_blank">Xavier Beltran Urbano</a> <br> Code: <a href="https://github.com/Frederik-Hartmann/BrainAtlas" rel="external nofollow noopener" target="_blank">Github</a> <br> Report: <a href="https://github.com/Frederik-Hartmann/BrainAtlas/blob/main/report/AtlasReport_BeltranAndHartmann.pdf" rel="external nofollow noopener" target="_blank">Githhub</a></p> <p><em>This project was carried out within the scope of the Medical Image Registration course taught by <a href="https://scholar.google.com/citations?user=M_sM6x8AAAAJ&amp;hl=en" rel="external nofollow noopener" target="_blank">Prof. Dr. Robert Martí</a>. You can reach a detailed report <a href="">here</a>.</em></p> <p>November 2023</p> <hr> <hr> <h2 id="dataset">Dataset</h2> <p>The atlas was built out of 15 different T1 scans of the brain. In addition to the T1 scans, segmentation masks for background, cerebrospinal fluid (CSF), white matter (WM), and grey matter (GM) were provided.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/DATASET-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/DATASET-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/DATASET-1400.webp"></source> <img src="/assets/projectImages/atlas/DATASET.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="dataset" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example from the dataset. A) T1; B) Segmentation mask of CSF, WM, and GM C) Mask of the Brain Tissue Area</div> <h2 id="building-the-atlas">Building the Atlas</h2> <p>In order to build the atlas, all images need to be registered to the same image. But what image should I choose as the fixed image? In general, the image most similar to all others will allow for easier registration and better performance. To locate the fixed image, comparisons between images can be conducted using similarity metrics like mean square error or mutual information.</p> <h3 id="registration">Registration</h3> <p>The registrations were carried out using <a href="https://pypi.org/project/itk-elastix/" rel="external nofollow noopener" target="_blank">itk-elastix</a>. First, the images are registered rigidly. Secondly, the images are registered with an affine registration. Thirdly, a b-spline multi- resolution registration is performed. Here, an image pyramid with six levels is chosen. Each level’s resolution is half of the previous level. Furthermore, an advanced normalised correlation metric with a transform bending energy penalty is chosen. The parameters as well as the authors can be found on <a href="https://github.com/SuperElastix/ElastixModelZoo/tree/master/models/Par0038" rel="external nofollow noopener" target="_blank">ModelZoo</a>.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/Registration-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/Registration-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/Registration-1400.webp"></source> <img src="/assets/projectImages/atlas/Registration.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="registration" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example of the registration results. In the first half of the figure,we include the original image and corresponding ground truth. A,B, C, and D correspond to the images 1010 (fixed), 1013, 1036, and 1017, respectively. In the second half of the figure, we can observe the registration of both the original image and the ground truth. E,F, G, and H correspond to the images 1010 (fixed), 1013, 1036, and 1017, respectively. </div> <h3 id="label-propagation">Label Propagation</h3> <p>The next step is label propagation. In the previous step, we computed the transformation parameters for the intensity parameters. Now we need to apply this transformation to the masks. In order to avoid the mixing of different tissues, i.e., interpolation errors, the transformations are computed separately.</p> <h3 id="putting-everything-together">Putting everything together</h3> <p>Having applied the transormation to the mask, the atlas can be computed. For this, the voxel-wise mean for each propagated tissue mask is taken. This mean can be interpreted as a probability of a voxel belonging to the tissue. Further, we need to provide an image to allow for registration with the atlas. For this, the mean of all intensity images is taken.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/atlas-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/atlas-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/atlas-1400.webp"></source> <img src="/assets/projectImages/atlas/atlas.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="atlas" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example of different planes (Axial, Coronal and Sagital) of different slices of our probabilistic atlas. A) Slice nº 145, B) Slice nº156, C) Slice nº91, D) Slice nº185. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/meanImage-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/meanImage-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/meanImage-1400.webp"></source> <img src="/assets/projectImages/atlas/meanImage.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="atlas" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example of slice nº151 of our final Mean Image. </div> <h2 id="building-the-tissue-model">Building the tissue model</h2> <p>While the atlas provided a probability based on the spatial position of a voxel, the tissue model provides a probability based on the intensity of a voxel. In order to accomplish this, the histogram is computed, normalised to a probability density function, and finally converted to a conditional probability, i.e., the probability of a voxel with an intensity x of belonging to a specific tissue. This is called a tissue model.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/Distribution-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/Distribution-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/Distribution-1400.webp"></source> <img src="/assets/projectImages/atlas/Distribution.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="histogram" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Intensity distribution of the different tissues in the dataset. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/Distribution_Norm-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/Distribution_Norm-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/Distribution_Norm-1400.webp"></source> <img src="/assets/projectImages/atlas/Distribution_Norm.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="probabilty density function" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Normalized intensity distribution of the different tissues in the dataset. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/projectImages/atlas/ProbabilityHistogram-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/projectImages/atlas/ProbabilityHistogram-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/projectImages/atlas/ProbabilityHistogram-1400.webp"></source> <img src="/assets/projectImages/atlas/ProbabilityHistogram.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Tissue model" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The Tissue Model </div> <h2 id="conclusion">Conclusion</h2> <p>This research developed an advanced method for creating a detailed probabilistic brain atlas and tissue probability models using image registration techniques. Our approach, from rigid registration to label propagation, resulted in an atlas with precise tissue boundaries. This work aids in MRI tissue mapping, potentially improving diagnostics. We plan to extend this to more accurate brain tissue segmentation, which could significantly help in neurological diagnosis and treatment.</p> </article> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Frederik Hartmann. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>